# 监控摄像头掉线恢复

事件经过：公司某楼层的摄像头掉线，需要确定具体是哪个位置的摄像头，尝试不同方法解决掉线问题，给上级答复具体原因，后续提出整改方案报备给甲方。

## 基础知识

POE交换机最好选千兆交换机，不易掉线；POE交换机上的摄像头，每个摄像头都有独立IP。

1. 一会上一会掉线，大多数是IP地址冲突了，像反复上下线，多数都是他中间网络问题，可能存在网络风暴，或者交换机满载。
2. 除非设备损坏，或水晶头与接口间松动，它会一直掉线不上线。

以及相关室外因素

1. 室外的poe设备网口进水故障导致的网口烧了，不通电。
2. poe传输距离过远，导致的poe供电能力不够。

## 根据设备地址表及拓扑图找到物理位置

admin 进入监控 web 界面，查看掉线摄像头编号，通过掉线摄像头及附近的摄像头的编号，再打开施工方留下的监控点位图。

摄像头编号规则：SZ 深圳，XX 公司名，XS 销售，字母及数字；摄像头编号下面为 IP 地址。

![ ](https://cdn.sa.net/2024/10/12/I9VyAiSZnd3fmck.png)

再用摄像头登记信息表进行确认掉线具体楼层以及相关的摄像头 IP

![ ](https://cdn.sa.net/2024/10/12/Z6qGEY9ABMfniQt.png)


## 定位问题

### ping + arp + mac

确定掉线摄像头的 IP 后，用交换机地址去 ping 摄像头地址 `ping -S <源IP地址> <目标IP地址>`




### 流量统计分析

* [华为 - 配置基于ACL的流量统计示例](https://support.huawei.com/enterprise/zh/doc/EDOC1100301664/b46238d5)
* [华为 - 如何部署流量统计功能](https://support.huawei.com/enterprise/zh/doc/EDOC1100087018)


### 查看监控交换机端口错包

通过 `dis int g 0/0/x` 相应的具体接口，看下 CRC。CRC没有错包则说明，自动协商或设定协商没有问题，以及交换机端口也没问题。

> [华为 - 交换机接口CRC错包故障的处理](https://support.huawei.com/enterprise/zh/knowledge/EKB1001714454)

1. 如果错包计数持续增加,一般是线路侧受到干扰导致的,优先排除线质量问题。
2. 保证两端接口自协商模式一致,两端均配置成强制模式或者均配置成自协商模式。如果配置了强制模式,速率和双工也要保持一致。
3. 检查两端接口收发光功率,主要是收光功率和发光功率。如果发光功率和电流有问题,则更换光模块;如果收光功率有问题,则需要检查对端发光和链路衰减,可以按照下面的步骤检查。
4. 检查光纤长度,光纤的长度在规定的范围之内:对接两端口使用模块波长一致,但是由于传输距离较长超出了规定的范围,也会出现光功率较低的告警。
5. 检查链路对接质量,重新插拔光纤及光模块,看是否接触不良所致。同时查看一下光纤头是否被损坏或者污染,并进行清洁。
6. 采用交叉测试定确定故障点,针对本端光模块、光纤链路(包括光纤、跳线架、熔纤点、分光器以及波分传输等中间设备)、对端光模块的问题。

> [Cisco - 请教关于交换机端口giants、input errors、CRC的问题](https://community.cisco.com/t5/%E4%BA%A4%E6%8D%A2%E8%AE%A8%E8%AE%BA%E5%8C%BA/%E8%AF%B7%E6%95%99%E5%85%B3%E4%BA%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%AB%AF%E5%8F%A3giants-input-errors-crc%E7%9A%84%E9%97%AE%E9%A2%98/td-p/4359015)

**CRC**

当始发 LAN 站或远端设备生成的 CRC 与根据接收的数据计算的校验和不匹配时，此 CRC 将递增。常见原因： 这通常表示 LAN 接口或 LAN 本身存在噪音或传输问题。大量 CRC 通常是冲突的结果，但也可能表示物理问题（例如布线、接口或 NIC 损坏）或双工不匹配。

**Input errors**

常见原因：这包括残帧、巨型帧、无缓冲区、CRC、帧、溢出和忽略计数。其他与输入相关的错误也可能导致输入错误计数增加，并且某些数据报可能有多个错误。

相关参考：[华为 - FAQ-CE6850接口出现inerrors错包](https://support.huawei.com/enterprise/zh/knowledge/EKB1001809466)、[华为 - s系列交换机接口出现大量错误包导致用户网络访问异常缓慢](https://support.huawei.com/enterprise/zh/knowledge/EKB1000072395)。

### 综合

结合以上，交换机物理端口没有问题，交换机ping摄像头没回包，说明：

* 水晶头至摄像头接口接触问题（松动、断开、接触不良）
* 摄像头有问题
* 整条链路中断

经过重插水晶头，掉线的摄像头又能正常联网了，保险起见重做水晶头。水晶头如果压的不紧，那么在长期的使用/挪动中，就会发生接触不良的情况，而在插拔网线的时候，可能碰巧又把它们给贴合在一起了，因此就可以联网了。

### 附：交换机满载

> 引用 [huawei - S系列交换机CPU占用率高](https://support.huawei.com/enterprise/zh/doc/EDOC1100088139)

![](https://download.huawei.com/mdl/image/download?uuid=d763bc5598484559a89dc88e27635be5)

![](https://download.huawei.com/mdl/image/download?uuid=8e2f25bc08df47f28f96fac46c4bf5f5)