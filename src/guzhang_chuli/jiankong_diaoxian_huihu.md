# 监控摄像头掉线恢复

事件经过：公司某楼层的摄像头掉线，需要确定具体是哪个位置的摄像头，尝试不同方法解决掉线问题，给上级答复具体原因，后续提出整改方案报备给甲方。

## 有了经验后解决问题的过程

### 根据设备地址表及拓扑图找到物理位置

admin 进入监控 web 界面，查看掉线摄像头编号，通过掉线摄像头及附近的摄像头的编号，再打开施工方留下的监控点位图。

摄像头编号规则：SZ 深圳，XX 公司名，XS 销售，字母及数字；摄像头编号下面为 IP 地址。

![ ](https://cdn.sa.net/2024/10/12/I9VyAiSZnd3fmck.png)

### 确认摄像头IP，做后续进一步排查

再用摄像头登记信息表进行确认掉线具体楼层以及相关的摄像头 IP

![ ](https://cdn.sa.net/2024/10/12/Z6qGEY9ABMfniQt.png)

### 插拔网线以及测线

水晶头如果压的不紧，那么在长期的使用/挪动中，就会发生接触不良的情况，而在插拔网线的时候，可能碰巧又把它们给贴合在一起了，因此就可以联网了。测线仪测线发现只有只有4芯 1236 灯亮，需要重新走线，确保8芯全亮。对于百兆PoE交换机：供电标准下网线只要1、2、3、6线芯连通即可，既走数据又供电；当然如果你想1236走数据，4578供电，那么必须要8芯网线，并且保证8芯全部连通。


### 寻线到具体交换机具体端口

通过网络拓扑图，根据具体楼层对应的监控接入交换机进行寻线查找，进入机房观察设备信息标识卡找到其所属交换机大概位置，用寻线仪扫荡该范围网线，从而确定具体位置。

观察范围内的交换机有多少端口闪烁，有多少端口熄灭，拔插跳线，看问题摄像头是否掉线或在线，将寻线仪探针怼进交换机端口确认信号。


### 布线

拉一箱网线，将网线放线于墙壁上的横梁上方，两边人手搭上梯子一人放线，一人拉线，沿着墙壁周长呈 L 角放线，线路延伸至穿过隔间，打开隔间相邻的天花板，甩线进入天花板，开始从隔间天花板拉线直至走到机房天花板，从机房天花板上将网线拉下来，解开挡板，将网线放入挡板，穿过地板走线到机柜背面一头，接模块或端口。

* [单兵作战-理线上柜全过程，全程解压。](https://www.douyin.com/video/7013747611572260111)
* [仲子路智能 - 第16集 | 办公室综合布线全过程，项目内容有：网络布线、监控、无线AP。](https://www.douyin.com/video/7160569318734974222)
* [工程弱电安防 - 深圳办公室网络布线和网络组建](https://www.douyin.com/video/7340817998141295882)

### 总结

POE交换机最好选千兆交换机，不易掉线；POE交换机上的摄像头，每个摄像头都有独立IP。

1. 一会上一会掉线，大多数是IP地址冲突了，像反复上下线，多数都是他中间网络问题，可能存在网络风暴，或者交换机满载。
2. 除非设备损坏，或水晶头与接口间松动，它会一直掉线不上线。

以及相关室外因素

1. 室外的poe设备网口进水故障导致的网口烧了，不通电。
2. poe传输距离过远，导致的poe供电能力不够。

结合以上，交换机物理端口没有问题，交换机ping摄像头没回包，说明：

* 网线至摄像头接口接触问题，包括：松动、断开、4芯亮、接触不良。
* 摄像头有问题，摄像头问题通常是直接坏了。
* 整条链路中断，从工位到机房无法寻线找出具体端口，无任何信号音，交换机端口无亮灯。
* 在摄像头画面输出正常，IP地址无误的情况下，但 ping 不通，说明子网掩码及网关配错了，可找相邻IP摄像头对照配置。

---

## 没经验尝试解决问题的经过

### 确认流量走向状态

确定掉线摄像头的 IP 后，可进行流量统计分析，是否长时间掉线未恢复，未回包。

* [华为 - 配置基于ACL的流量统计示例](https://support.huawei.com/enterprise/zh/doc/EDOC1100301664/b46238d5)
* [华为 - 如何部署流量统计功能](https://support.huawei.com/enterprise/zh/doc/EDOC1100087018)

### 检查交换机端口

查看监控交换机端口错包，通过 `dis int g 0/0/x` 相应的具体接口，看下 CRC。CRC没有错包则说明，自动协商或设定协商没有问题，以及交换机端口也没问题。

> [华为 - 交换机接口CRC错包故障的处理](https://support.huawei.com/enterprise/zh/knowledge/EKB1001714454)

1. 如果错包计数持续增加,一般是线路侧受到干扰导致的,优先排除线质量问题。
2. 保证两端接口自协商模式一致,两端均配置成强制模式或者均配置成自协商模式。如果配置了强制模式,速率和双工也要保持一致。
3. 检查两端接口收发光功率,主要是收光功率和发光功率。如果发光功率和电流有问题,则更换光模块;如果收光功率有问题,则需要检查对端发光和链路衰减,可以按照下面的步骤检查。
4. 检查光纤长度,光纤的长度在规定的范围之内:对接两端口使用模块波长一致,但是由于传输距离较长超出了规定的范围,也会出现光功率较低的告警。
5. 检查链路对接质量,重新插拔光纤及光模块,看是否接触不良所致。同时查看一下光纤头是否被损坏或者污染,并进行清洁。
6. 采用交叉测试定确定故障点,针对本端光模块、光纤链路(包括光纤、跳线架、熔纤点、分光器以及波分传输等中间设备)、对端光模块的问题。

> [Cisco - 请教关于交换机端口giants、input errors、CRC的问题](https://community.cisco.com/t5/%E4%BA%A4%E6%8D%A2%E8%AE%A8%E8%AE%BA%E5%8C%BA/%E8%AF%B7%E6%95%99%E5%85%B3%E4%BA%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%AB%AF%E5%8F%A3giants-input-errors-crc%E7%9A%84%E9%97%AE%E9%A2%98/td-p/4359015)

#### 基础知识查询及储备

**CRC**

当始发 LAN 站或远端设备生成的 CRC 与根据接收的数据计算的校验和不匹配时，此 CRC 将递增。常见原因： 这通常表示 LAN 接口或 LAN 本身存在噪音或传输问题。大量 CRC 通常是冲突的结果，但也可能表示物理问题（例如布线、接口或 NIC 损坏）或双工不匹配。

**Input errors**

常见原因：这包括残帧、巨型帧、无缓冲区、CRC、帧、溢出和忽略计数。其他与输入相关的错误也可能导致输入错误计数增加，并且某些数据报可能有多个错误。

相关参考：[华为 - FAQ-CE6850接口出现inerrors错包](https://support.huawei.com/enterprise/zh/knowledge/EKB1001809466)、[华为 - s系列交换机接口出现大量错误包导致用户网络访问异常缓慢](https://support.huawei.com/enterprise/zh/knowledge/EKB1000072395)。

### 检查交换机运转

**交换机满载现象**

> 引用 [huawei - S系列交换机CPU占用率高](https://support.huawei.com/enterprise/zh/doc/EDOC1100088139)

![](https://download.huawei.com/mdl/image/download?uuid=d763bc5598484559a89dc88e27635be5)

**查看交换机CPU**

![](https://download.huawei.com/mdl/image/download?uuid=8e2f25bc08df47f28f96fac46c4bf5f5)

### 拆装与配置摄像头

> 电脑可直连摄像头，但需 12v 供电，电压太大易烧坏，双方配置同一网段即可访问，chrome 浏览器需要安装插件才能显示画面。

拆装摄像头视频

* [海康威视小助手- 海康威视半球海螺摄像头安装实操视频](https://www.douyin.com/video/7065915359152377099)
* [阿智电器维修 - 海康威视摄像头盖子是不是很难拆，怎么撬也撬不开，其实方法不对](https://www.bilibili.com/video/BV1XQ4y137Hk/)

设置 IP 视频

* [杭州杨师傅教你装监控，海康威视网络摄像头修改IP，电脑修改IP地址](https://www.douyin.com/video/7220430340706356519)
* [秦皇岛弱电智能化工程 - 给大家看看这个700多个点位的监控系统是如何设置ip的呢](https://www.douyin.com/video/7312996957692202240)


### 接入网线，恢复正常

测试完摄像头正常工作，接入此前网线恢复正常。

---

## 有经验和没经验

### 区别 

有经验的判断思路更系统、依赖于设备的具体信息和网络拓扑，能够迅速定位问题源头，进行有效的布线和配置。

而无经验者往往依赖于基础检查，可能缺乏对流量走向和设备状态的深入理解，解决问题的过程相对冗长，思路相对极大受限，想到什么是什么，缺乏方向而处处碰壁，没有自己的知识体系逻辑链条。

总的来说，有经验的人能更快地识别问题并采取针对性措施，而无经验者则可能在基础步骤中徘徊。

### 突破

在工作中观察其他人的操作，尽量理解他们的思路和方法。分析设备和系统的运作，尝试理解其背后的原理。针对问题，创建一个问题清单，逐个查找解决方案，并汇总。

### 思路

**数据分析**

* 有经验：善于利用数据和监控工具，能够从多个维度分析问题，识别异常流量和状态。
* 无经验：对数据分析的能力较弱，可能只关注表面现象，缺乏深入分析的技巧。

**系统思维**

* 有经验：能从整体架构出发考虑问题，理解各个设备之间的相互关系，能够推测问题可能的根源。
* 无经验：往往局限于个别设备或组件，难以建立全局视角，导致解决方案片面。

**解决方案的制定**

* 有经验：能够迅速提出针对性的解决方案，并评估其可行性，常根据历史经验调整策略。
* 无经验：可能缺乏针对性的解决方案，常常依赖试错法，效率较低。

**总结与反思能力**

* 有经验：习惯于在解决问题后进行总结和反思，持续改进自己的方法和思路。
* 无经验：可能缺乏这种进一层的反思意识，难以从记录经历中学习，改进思路。