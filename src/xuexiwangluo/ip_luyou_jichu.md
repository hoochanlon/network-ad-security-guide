# IP路由基础

## 路由优先级比较

IP路由最长匹配原则：

![PixPin_2024-12-16_19-37-01](https://img.yonrd.com/i/2024/12/16/w1fdsn.png)

当存在多个路由信息源时，具有较高优先级（取值较小）的路由协议发现的路由将成为最优路由。

常见的路由优先级：

* 直连 0
* OSPF 10
* 静态 60
* BGP 255

**总结**

* 相同的前缀，且通过不同的协议获取，先比路由协议优先级，优先的条目装载进路由表，如果路由协议优先级相等，则比较度量值。
* 在路由查找时采用最长匹配原则，匹配、转发；没有匹配项，则找缺省路由，如果也没有缺省路由，则丢弃数据包。
* 路由表的行为是逐跳的，到目标网络的沿路径每个路由器都必须有关于目标的路由，否则就会造成丢包。
* 数据是双向的，考虑流量的时候，要关注流量的往返。

![PixPin_2024-12-16_20-32-04](https://img.yonrd.com/i/2024/12/16/xn8qzh.png)

## 路由转发原则

![PixPin_2024-12-16_22-01-03](https://img.yonrd.com/i/2024/12/16/10emzrf.png)

路由交换——数据转发的动作，将封装好的数据转发到下一个节点，当我们的数据封装到网络层之后，怎么转发给下一个节点。这时候就需要用到路由器（路由动作发给下一跳设备）和交换机（交换工作实现转发给下一跳）。

总结：数据传递的过程要么就是路由，要么就是交换。分别对应的网络层的寻址方式，链路层转发的方式。

路由转发：三层转发（网络层称为三层）

交换转发：二层转发（数据链路层称为二层，基于MAC地址转发）

## 交换转发原则

> 摘抄：[松山湖开发者村综合服务平台](https://community.sslcode.com.cn/6728244082931a478c181fc9.html)

交换机转发依据 — MAC地址表：

* 在以太网中有一个重要的机制—ARP（地址解析协议）：知道了访问的ip地址，查询mac地址的过程。
  * ARP请求：根据ip寻找mac地址，这是一种广播的方式请求。
  * ARP应答：根据ip应答mac地址，这是一种单播的方式请求。

交换机收到ARP报文后，会进行两件事情：

* 学习： 当数据帧进入到交换机的接口后，交换机实现将源mac和接口对应起来的动作就叫做学习，并存储MAC地址表中。

* 转发：根据MAC地址，查询mac地址表转发，每一个硬件在厂家出厂的时候，都会给设备打上一个唯一的标识符，用于识别该设备。

进化：VLAN，虚拟局域网 — 减小广播域的范围，存在于交换机的概念。在同区域之间才会泛洪，不同区域之间不会泛洪，减少广播域的泛洪范围。

> chatgpt 摘抄

**ARP** ：它的主要作用是帮助网络设备通过IP地址查找对应的MAC地址。

**Ethernet**：是面向局域网的协议，通常用于多设备之间的通信。它通过交换机、路由器等设备将多个设备连接起来，支持广播和多播通信。主要定义了如何在物理网络介质（如电缆、光纤等）上进行帧的封装与传输。如何通过MAC地址在局域网内进行通信。

**PPP**：通常用于单一设备与远程服务器或ISP之间的通信，它还提供链路控制、错误检测、认证等功能。


## 网络分层设计

![PixPin_2024-12-16_21-18-57](https://img.yonrd.com/i/2024/12/16/z2at5e.png)

![PixPin_2024-12-16_21-23-27](https://img.yonrd.com/i/2024/12/16/z47tr7.png)

[什么是IP路由？IP路由是如何工作的？ - 华为](https://info.support.huawei.com/info-finder/encyclopedia/zh/IP路由.html)

[网络TCP/IP基础（IP地址网络汇总与规划）-云社区-华为云](https://bbs.huaweicloud.com/blogs/330876)

## 路由知识扩展

### 路由迭代

![PixPin_2024-12-16_20-43-18](https://img.yonrd.com/i/2024/12/16/xu4zu3.png)

必要条件：路由必须有直连的下一跳才能够指导转发。

实际情况：路由生成时下一跳可能不是直连的，因此需要计算出一个直连的下一跳和对应的出接口，这个过程就叫做路由递归。

口语表达：写错了路由，还可以插入目的地址对应的网段指向下一跳。

### 等价路由

等价路由用于负载均衡，负载均衡用于解决性能、单点故障（高可用）和扩展性（水平伸缩）等问题。

![PixPin_2024-12-16_20-58-07](https://img.yonrd.com/i/2024/12/16/y1mtda.png)

### 浮动路由

口头语：设置优先级的路由，用做备选路径的路由。

![PixPin_2024-12-16_21-09-44](https://img.yonrd.com/i/2024/12/16/ywa3d2.png)

###  路由汇总

如图所示

![PixPin_2024-12-16_21-13-53](https://img.yonrd.com/i/2024/12/16/yyn9yj.png)

